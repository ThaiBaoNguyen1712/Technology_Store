
@{
    ViewData["Title"] = "StockManager";
    Layout = "~/Areas/Admin/Views/Shared/Layout.cshtml";
}

<div class="container-fluid">
    <h2 class="my-4">Quản lý Kho</h2>

    <!-- Filter Section -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">SKU sản phẩm</label>
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Nhập hoặc scan mã SKU" id="filterCode">
                        <span class="input-group-text"><i class="fas fa-barcode"></i></span>
                    </div>

                </div>
                <div class="col-md-3">
                    <label class="form-label">Tên sản phẩm</label>
                    <input type="text" class="form-control" placeholder="Nhập tên sản phẩm" id="filterName">
                </div>
                <div class="col-md-3">
                    <label class="form-label">Loại</label>
                    <select class="form-select" id="filterType">
                        <option value="">Tất cả</option>
                        <option value="nhap">Nhập kho</option>
                        <option value="xuat">Xuất kho</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Trạng thái</label>
                    <select class="form-select" id="filterStatus">
                        <option value="">Tất cả</option>
                        <option value="1">Hoàn thành</option>
                        <option value="0">Đang xử lý</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Actions -->
    <div class="mb-4">
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#productModal">
            <i class="fas fa-plus"></i> Thêm mới
        </button>
        <button class="btn btn-success" id="exportExcel">
            <i class="fas fa-file-excel"></i> Xuất Excel
        </button>
        <button class="btn btn-light " data-bs-toggle="modal" data-bs-target="#productModal">
            <i class="fas fa-history"></i> Lịch sử

        </button>
    </div>

    <!-- Table -->
    <div class="card">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered table-hover">
                    <thead>
                        <tr>
                            <th>Mã SP</th>
                            <th>Tên sản phẩm</th>
                            <th>Loại</th>
                            <th>Số lượng</th>
                            <th>Đơn giá</th>
                            <th>Thành tiền</th>
                            <th>Trạng thái</th>
                            <th>Thao tác</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>SP001</td>
                            <td>Sản phẩm A</td>
                            <td>Nhập kho</td>
                            <td>100</td>
                            <td>100,000</td>
                            <td>10,000,000</td>
                            <td><span class="badge bg-success">Hoàn thành</span></td>
                            <td>
                                <button class="btn btn-sm btn-info" data-bs-toggle="modal" data-bs-target="#productModal">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-danger">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td>SP002</td>
                            <td>Sản phẩm B</td>
                            <td>Xuất kho</td>
                            <td>50</td>
                            <td>200,000</td>
                            <td>10,000,000</td>
                            <td><span class="badge bg-warning text-dark">Đang xử lý</span></td>
                            <td>
                                <button class="btn btn-sm btn-info" data-bs-toggle="modal" data-bs-target="#productModal">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-danger">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="productModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Thông tin sản phẩm</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="productForm">
                    <div class="mb-3">
                        <label class="form-label">Mã sản phẩm</label>
                        <input type="text" class="form-control" name="code">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Tên sản phẩm</label>
                        <input type="text" class="form-control" name="name">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Loại</label>
                        <select class="form-select" name="type">
                            <option value="nhap">Nhập kho</option>
                            <option value="xuat">Xuất kho</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Số lượng</label>
                        <input type="number" class="form-control" name="quantity">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Đơn giá</label>
                        <input type="number" class="form-control" name="price">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Trạng thái</label>
                        <select class="form-select" name="status">
                            <option value="1">Hoàn thành</option>
                            <option value="0">Đang xử lý</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-primary" id="saveProduct">Lưu</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>

<script>
    $(document).ready(function () {
        // Filter handling
        $('.form-control, .form-select').on('change keyup', function () {
            filterTable();
        });

        function filterTable() {
            const code = $('#filterCode').val().toLowerCase();
            const name = $('#filterName').val().toLowerCase();
            const type = $('#filterType').val();
            const status = $('#filterStatus').val();

            $('tbody tr').each(function () {
                const row = $(this);
                const rowCode = row.find('td:eq(0)').text().toLowerCase();
                const rowName = row.find('td:eq(1)').text().toLowerCase();
                const rowType = row.find('td:eq(2)').text().toLowerCase();
                const rowStatus = row.find('td:eq(6) .badge').hasClass('bg-success') ? '1' : '0';

                const matchCode = !code || rowCode.includes(code);
                const matchName = !name || rowName.includes(name);
                const matchType = !type || rowType.includes(type);
                const matchStatus = !status || rowStatus === status;

                if (matchCode && matchName && matchType && matchStatus) {
                    row.show();
                } else {
                    row.hide();
                }
            });
        }

        // Save product
        $('#saveProduct').click(function () {
            const formData = {};
            $('#productForm').serializeArray().forEach(item => {
                formData[item.name] = item.value;
            });

            // Here you would typically send formData to your backend
            console.log('Saving product:', formData);

            // Close modal
            $('#productModal').modal('hide');

            // Clear form
            $('#productForm')[0].reset();

            // Show success message
            alert('Lưu thành công!');
        });

        // Delete confirmation
        $('.btn-danger').click(function () {
            if (confirm('Bạn có chắc chắn muốn xóa?')) {
                // Delete handling
                console.log('Deleting item');
            }
        });

        // Export to Excel
        $('#exportExcel').click(function () {
            // Here you would typically implement Excel export logic
            alert('Tính năng xuất Excel đang được phát triển');
        });
    });
</script>