@{
    ViewData["Title"] = "Index";
    Layout = "~/Areas/Admin/Views/Shared/Layout.cshtml";
}
@model Tech_Store.Models.DTO.SettingDTo

<div class="container-fluid">
    <h2 class="my-4">Cài đặt Website</h2>
    <div class="row">
        <style>
            /* CSS chỉnh sửa tab active */
            .nav-tabs .nav-link.active {
                background-color: #007bff; /* Màu nền */
                color: white; /* Màu chữ */
                border-color: #007bff; /* Màu viền */
                font-weight: bold;
            }

            .nav-tabs .nav-link:hover {
                background-color: #e9ecef;
                color: #007bff;
            }
        </style>

        <main class="col-12 px-md-4 pt-3">
            <div class="container">
                <!-- Thanh Điều Hướng Tabs -->
                <ul class="nav nav-tabs mb-4" id="settingsTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="general-tab" data-bs-toggle="tab" data-bs-target="#general" type="button" role="tab">
                            <i class="fas fa-cog me-2"></i> Cài Đặt Chung
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="logo-tab" data-bs-toggle="tab" data-bs-target="#logo" type="button" role="tab">
                            <i class="fas fa-image me-2"></i> Logo
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="social-tab" data-bs-toggle="tab" data-bs-target="#social" type="button" role="tab">
                            <i class="fas fa-share-alt me-2"></i> Mạng Xã Hội
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#contact" type="button" role="tab">
                            <i class="fas fa-address-card me-2"></i> Thông Tin Liên Hệ
                        </button>
                    </li>
                </ul>

                <!-- Nội Dung Tabs -->
                <div class="tab-content" id="settingsTabContent">
                    <!-- Cài Đặt Chung -->
                    <div class="tab-pane fade show active" id="general" role="tabpanel">
                        <div class="card">
                            <div class="card-header">Cài Đặt Chung</div>
                            <div class="card-body">
                                <form id="generalForm">
                                    <div class="mb-3">
                                        <label for="siteName" class="form-label">Tên Trang Web</label>
                                        <input type="text" value="@Model.NameWebsite" class="form-control" id="siteName">
                                    </div>
                                    <div class="mb-3">
                                        <label for="siteSlogan" class="form-label">Slogan</label>
                                        <input type="text" class="form-control" value="@Model.Slogan" id="siteSlogan">
                                    </div>
                                    <div class="mb-3">
                                        <label for="siteDescription" class="form-label">Mô Tả Trang Web</label>
                                        <textarea class="form-control" id="siteDescription" rows="3">@Model.Description</textarea>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Cài Đặt Logo -->
                    <div class="tab-pane fade" id="logo" role="tabpanel">
                        <div class="card">
                            <div class="card-header">Cài Đặt Logo</div>
                            <div class="card-body">
                                <form id="logoForm">
                                    <div class="mb-3">
                                        <label for="logoUpload" class="form-label">Tải Lên Logo</label>
                                        <input class="form-control" type="file" id="logoUpload" accept="image/*">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Xem Trước Logo</label>
                                        <div class="text-center">
                                            @if(!string.IsNullOrEmpty(Model.LogoUrl))
                                            {
                                                <img id="logoPreview" src="@Model.LogoUrl" class="img-fluid" alt="Logo Preview" style="max-height: 200px;">
                                            }
                                            <img id="logoPreview" src="#" class="img-fluid" alt="Logo Preview" style="max-height: 200px; display: none;">
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Cài Đặt Mạng Xã Hội -->
                    <div class="tab-pane fade" id="social" role="tabpanel">
                        <div class="card">
                            <div class="card-header">Liên Kết Mạng Xã Hội</div>
                            <div class="card-body">
                                <form id="socialForm">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="facebookLink" class="form-label">
                                                <i class="fab fa-facebook me-2 text-primary"></i> Facebook
                                            </label>
                                            <input type="url" class="form-control" value="@Model.FacebookUrl" id="facebookLink" placeholder="https://facebook.com/trangcuaban">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="instagramLink" class="form-label">
                                                <i class="fab fa-instagram me-2 text-danger"></i> Instagram
                                            </label>
                                            <input type="url" class="form-control" value="@Model.InstagramUrl" id="instagramLink" placeholder="https://instagram.com/trangcuaban">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="twitterLink" class="form-label">
                                                <i class="fab fa-twitter me-2 text-info"></i> Twitter
                                            </label>
                                            <input type="url" class="form-control" id="twitterLink" value="@Model.TwitterUrl" placeholder="https://twitter.com/trangcuaban">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="youtubeLink" class="form-label">
                                                <i class="fab fa-youtube me-2 text-danger"></i> YouTube
                                            </label>
                                            <input type="url" class="form-control" id="youtubeLink" value="@Model.YouTubeUrl" placeholder="https://youtube.com/channel/trangcuaban">
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Thông Tin Liên Hệ -->
                    <div class="tab-pane fade" id="contact" role="tabpanel">
                        <div class="card">
                            <div class="card-header">Thông Tin Liên Hệ</div>
                            <div class="card-body">
                                <form id="contactForm">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="companyName" class="form-label">Tên Công Ty/Tổ Chức</label>
                                            <input type="text" class="form-control" value="@Model.NameCompany" id="companyName">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="phoneNumber" class="form-label">Số Điện Thoại</label>
                                            <input type="tel" class="form-control" value="@Model.PhoneNumber" id="phoneNumber">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="emailContact" class="form-label">Email Liên Hệ</label>
                                            <input type="email" class="form-control" value="@Model.Email" id="emailContact">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="address" class="form-label">Địa Chỉ</label>
                                            <input type="text" class="form-control" value="@Model.Address" id="address">
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="additionalInfo" class="form-label">Thông Tin Bổ Sung</label>
                                        <textarea class="form-control" id="additionalInfo" rows="3">@Model.MoreInfo</textarea>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Nút Lưu Cài Đặt -->
                <div class="mt-4 mb-4 text-end">
                    <button id="saveSettings" class="btn btn-primary">
                        <i class="fas fa-save me-2"></i> Lưu Cài Đặt
                    </button>
                </div>
            </div>
        </main>
    </div>
</div>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
        $(document).ready(function () {
            // Xem trước logo khi tải lên
            $('#logoUpload').change(function () {
                const file = this.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        $('#logoPreview').attr('src', e.target.result).show();
                    }
                    reader.readAsDataURL(file);
                }
            });

            // Lưu cài đặt
            $('#saveSettings').click(function (e) {
                e.preventDefault(); // Ngăn form reload trang

                // Hiển thị hộp thoại xác nhận với SweetAlert
                Swal.fire({
                    title: 'Bạn có chắc chắn?',
                    text: 'Cài đặt sẽ được lưu lại!',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Lưu',
                    cancelButtonText: 'Hủy',
                }).then((result) => {
                    if (result.isConfirmed) {
                        $('.loading-container').show(); // Hiển thị loading

                        // Tạo FormData để upload logo
                        const formData = new FormData();
                        const logoFile = $('#logoUpload')[0].files[0];
                        if (logoFile) formData.append('LogoImage', logoFile); // Lưu đúng tên khớp với backend

                        // Thêm các dữ liệu khác vào FormData
                        formData.append('NameWebsite', $('#siteName').val());
                        formData.append('Slogan', $('#siteSlogan').val());
                        formData.append('Description', $('#siteDescription').val());
                        formData.append('FacebookUrl', $('#facebookLink').val());
                        formData.append('InstagramUrl', $('#instagramLink').val());
                        formData.append('TwitterUrl', $('#twitterLink').val());
                        formData.append('YouTubeUrl', $('#youtubeLink').val());
                        formData.append('NameCompany', $('#companyName').val());
                        formData.append('PhoneNumber', $('#phoneNumber').val());
                        formData.append('Email', $('#emailContact').val());
                        formData.append('Address', $('#address').val());
                        formData.append('MoreInfo', $('#additionalInfo').val());

                        // Gửi AJAX POST
                        $.ajax({
                            url: '/Admin/Settings/UpdateSettings',
                            type: 'POST',
                            data: formData,
                            contentType: false, // Không set Content-Type
                            processData: false, // Không xử lý dữ liệu thành chuỗi
                            success: function (response) {
                                $('.loading-container').hide(); // Ẩn loading
                                if (response.success) {
                                    Swal.fire({
                                        title: 'Thành công!',
                                        text: response.message,
                                        icon: 'success',
                                        confirmButtonText: 'Đóng',
                                    });
                                } else {
                                    Swal.fire({
                                        title: 'Thất bại!',
                                        text: response.message,
                                        icon: 'error',
                                        confirmButtonText: 'Đóng',
                                    });
                                }
                            },
                            error: function (xhr) {
                                $('.loading-container').hide(); // Ẩn loading
                                console.error(xhr.responseText);
                                Swal.fire({
                                    title: 'Lỗi hệ thống!',
                                    text: 'Vui lòng thử lại.',
                                    icon: 'error',
                                    confirmButtonText: 'Đóng',
                                });
                            },
                        });
                    }
                });
            });


    });
</script>
